import React, { useState } from 'react';
import { ResponsiveContainer, ComposedChart, Line, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ReferenceLine } from 'recharts';

// Utility functions
const dateToNumber = (date) => {
    if (typeof date === 'number') return date;
    const [year, month] = date.split('-').map(Number);
    return year + (month - 1) / 12;
};

const numberToLabel = (num, view) => {
    if (view === 'crisis') {
        const year = Math.floor(num);
        const month = Math.round((num - year) * 12) + 1;
        return `${year}`;
    }
    if (view === 'historical' && num < 0) {
        return `${-num}k BCE`;
    }
    return `${Math.round(num)}`;
};

const generateTicks = (start, end, interval) => {
    const ticks = [];
    for (let i = start; i <= end; i += interval) {
        ticks.push(i);
    }
    return ticks;
};


// Historical temperature data following Marcott et al. 2013 reconstruction
// Data points every 100 years from -9000 to present
export const historicalData = [
    { year: -9000, anomaly: -0.27 },
    { year: -8900, anomaly: -0.25 },
    { year: -8800, anomaly: -0.23 },
    { year: -8700, anomaly: -0.20 },
    { year: -8600, anomaly: -0.17 },
    { year: -8500, anomaly: -0.14 },
    { year: -8400, anomaly: -0.11 },
    { year: -8300, anomaly: -0.08 },
    { year: -8200, anomaly: -0.05 },
    { year: -8100, anomaly: -0.02 },
    { year: -8000, anomaly: 0.00 },
    { year: -7900, anomaly: 0.03 },
    { year: -7800, anomaly: 0.06 },
    { year: -7700, anomaly: 0.09 },
    { year: -7600, anomaly: 0.12 },
    { year: -7500, anomaly: 0.15 },
    { year: -7400, anomaly: 0.17 },
    { year: -7300, anomaly: 0.19 },
    { year: -7200, anomaly: 0.21 },
    { year: -7100, anomaly: 0.22 },
    { year: -7000, anomaly: 0.23 },
    { year: -6900, anomaly: 0.23 },
    { year: -6800, anomaly: 0.23 },
    { year: -6700, anomaly: 0.23 },
    { year: -6600, anomaly: 0.22 },
    { year: -6500, anomaly: 0.22 },
    { year: -6400, anomaly: 0.21 },
    { year: -6300, anomaly: 0.21 },
    { year: -6200, anomaly: 0.20 },
    { year: -6100, anomaly: 0.20 },
    { year: -6000, anomaly: 0.20 },
    { year: -5900, anomaly: 0.20 },
    { year: -5800, anomaly: 0.20 },
    { year: -5700, anomaly: 0.21 },
    { year: -5600, anomaly: 0.21 },
    { year: -5500, anomaly: 0.22 },
    { year: -5400, anomaly: 0.22 },
    { year: -5300, anomaly: 0.23 },
    { year: -5200, anomaly: 0.23 },
    { year: -5100, anomaly: 0.24 },
    { year: -5000, anomaly: 0.24 },
    { year: -4900, anomaly: 0.24 },
    { year: -4800, anomaly: 0.25 },
    { year: -4700, anomaly: 0.25 },
    { year: -4600, anomaly: 0.25 },
    { year: -4500, anomaly: 0.25 },
    { year: -4400, anomaly: 0.25 },
    { year: -4300, anomaly: 0.25 },
    { year: -4200, anomaly: 0.25 },
    { year: -4100, anomaly: 0.25 },
    { year: -4000, anomaly: 0.25 },
    { year: -3900, anomaly: 0.24 },
    { year: -3800, anomaly: 0.23 },
    { year: -3700, anomaly: 0.22 },
    { year: -3600, anomaly: 0.21 },
    { year: -3500, anomaly: 0.21 },
    { year: -3400, anomaly: 0.20 },
    { year: -3300, anomaly: 0.20 },
    { year: -3200, anomaly: 0.20 },
    { year: -3100, anomaly: 0.20 },
    { year: -3000, anomaly: 0.20 },
    { year: -2900, anomaly: 0.20 },
    { year: -2800, anomaly: 0.20 },
    { year: -2700, anomaly: 0.19 },
    { year: -2600, anomaly: 0.19 },
    { year: -2500, anomaly: 0.18 },
    { year: -2400, anomaly: 0.17 },
    { year: -2300, anomaly: 0.16 },
    { year: -2200, anomaly: 0.15 },
    { year: -2100, anomaly: 0.14 },
    { year: -2000, anomaly: 0.13 },
    { year: -1900, anomaly: 0.12 },
    { year: -1800, anomaly: 0.11 },
    { year: -1700, anomaly: 0.10 },
    { year: -1600, anomaly: 0.09 },
    { year: -1500, anomaly: 0.08 },
    { year: -1400, anomaly: 0.07 },
    { year: -1300, anomaly: 0.06 },
    { year: -1200, anomaly: 0.04 },
    { year: -1100, anomaly: 0.02 },
    { year: -1000, anomaly: 0.00 },
    { year: -900, anomaly: -0.02 },
    { year: -800, anomaly: -0.04 },
    { year: -700, anomaly: -0.06 },
    { year: -600, anomaly: -0.08 },
    { year: -500, anomaly: -0.10 },
    { year: -400, anomaly: -0.12 },
    { year: -300, anomaly: -0.14 },
    { year: -200, anomaly: -0.15 },
    { year: -100, anomaly: -0.16 },
    { year: 0, anomaly: -0.17 },
    { year: 100, anomaly: -0.18 },
    { year: 200, anomaly: -0.19 },
    { year: 300, anomaly: -0.20 },
    { year: 400, anomaly: -0.21 },
    { year: 500, anomaly: -0.22 },
    { year: 600, anomaly: -0.23 },
    { year: 700, anomaly: -0.24 },
    { year: 800, anomaly: -0.25 },
    { year: 900, anomaly: -0.26 },
    { year: 1000, anomaly: -0.27 },
    { year: 1100, anomaly: -0.28 },
    { year: 1200, anomaly: -0.29 },
    { year: 1300, anomaly: -0.30 },
    { year: 1400, anomaly: -0.31 },
    { year: 1500, anomaly: -0.32 },
    { year: 1600, anomaly: -0.33 },
    { year: 1700, anomaly: -0.34 },
    { year: 1800, anomaly: -0.35 },
    { year: 1850, anomaly: -0.36, isCritical: true },
    { year: 1900, anomaly: -0.32, isCritical: true },
    // Période récente de réchauffement rapide
    { year: 1950, anomaly: -0.20, isCritical: true },
    { year: 1980, anomaly: 0.00, isCritical: true },
    { year: 2000, anomaly: 0.50, isCritical: true },
    { year: 2010, anomaly: 0.90, isCritical: true },
    { year: 2020, anomaly: 1.20, isCritical: true },
    { year: 2024, anomaly: 1.52, isCritical: true, record: true }

].map(d => ({
    ...d,
    value: d.year
}));

// Reduced dataset for modern view
const modernData = [
    { year: 1850, anomaly: -0.111 },
    { year: 1851, anomaly: 0.009 },
    { year: 1852, anomaly: 0.034 },
    { year: 1853, anomaly: 0.028 },
    { year: 1854, anomaly: 0.021 },
    { year: 1855, anomaly: 0.024 },
    { year: 1856, anomaly: -0.106 },
    { year: 1857, anomaly: -0.244 },
    { year: 1858, anomaly: -0.040 },
    { year: 1859, anomaly: 0.074 },
    { year: 1860, anomaly: -0.081 },
    { year: 1861, anomaly: -0.160 },
    { year: 1862, anomaly: -0.269 },
    { year: 1863, anomaly: -0.031 },
    { year: 1864, anomaly: -0.065 },
    { year: 1865, anomaly: 0.029 },
    { year: 1866, anomaly: 0.073 },
    { year: 1867, anomaly: 0.118 },
    { year: 1868, anomaly: 0.082 },
    { year: 1869, anomaly: 0.078 },
    { year: 1870, anomaly: 0.013 },
    { year: 1871, anomaly: -0.019 },
    { year: 1872, anomaly: 0.013 },
    { year: 1873, anomaly: 0.045 },
    { year: 1874, anomaly: -0.004 },
    { year: 1875, anomaly: -0.045 },
    { year: 1876, anomaly: -0.051 },
    { year: 1877, anomaly: 0.330 },
    { year: 1878, anomaly: 0.417 },
    { year: 1879, anomaly: 0.071 },
    { year: 1880, anomaly: 0.003 },
    { year: 1881, anomaly: 0.123 },
    { year: 1882, anomaly: 0.054 },
    { year: 1883, anomaly: 0.003 },
    { year: 1884, anomaly: -0.168 },
    { year: 1885, anomaly: -0.131 },
    { year: 1886, anomaly: -0.160 },
    { year: 1887, anomaly: -0.189 },
    { year: 1888, anomaly: 0.017 },
    { year: 1889, anomaly: 0.140 },
    { year: 1890, anomaly: -0.150 },
    { year: 1891, anomaly: -0.029 },
    { year: 1892, anomaly: -0.089 },
    { year: 1893, anomaly: -0.065 },
    { year: 1894, anomaly: -0.057 },
    { year: 1895, anomaly: 0.009 },
    { year: 1896, anomaly: 0.103 },
    { year: 1897, anomaly: 0.118 },
    { year: 1898, anomaly: -0.085 },
    { year: 1899, anomaly: 0.081 },
    { year: 1900, anomaly: 0.190 },
    { year: 1901, anomaly: 0.115 },
    { year: 1902, anomaly: -0.044 },
    { year: 1903, anomaly: -0.144 },
    { year: 1904, anomaly: -0.202 },
    { year: 1905, anomaly: -0.021 },
    { year: 1906, anomaly: 0.063 },
    { year: 1907, anomaly: -0.111 },
    { year: 1908, anomaly: -0.136 },
    { year: 1909, anomaly: -0.200 },
    { year: 1910, anomaly: -0.161 },
    { year: 1911, anomaly: -0.174 },
    { year: 1912, anomaly: -0.101 },
    { year: 1913, anomaly: -0.074 },
    { year: 1914, anomaly: 0.111 },
    { year: 1915, anomaly: 0.164 },
    { year: 1916, anomaly: -0.073 },
    { year: 1917, anomaly: -0.224 },
    { year: 1918, anomaly: -0.059 },
    { year: 1919, anomaly: 0.005 },
    { year: 1920, anomaly: 0.059 },
    { year: 1921, anomaly: 0.112 },
    { year: 1922, anomaly: 0.026 },
    { year: 1923, anomaly: 0.058 },
    { year: 1924, anomaly: 0.048 },
    { year: 1925, anomaly: 0.093 },
    { year: 1926, anomaly: 0.231 },
    { year: 1927, anomaly: 0.116 },
    { year: 1928, anomaly: 0.127 },
    { year: 1929, anomaly: -0.059 },
    { year: 1930, anomaly: 0.171 },
    { year: 1931, anomaly: 0.229 },
    { year: 1932, anomaly: 0.189 },
    { year: 1933, anomaly: -0.006 },
    { year: 1934, anomaly: 0.144 },
    { year: 1935, anomaly: 0.082 },
    { year: 1936, anomaly: 0.152 },
    { year: 1937, anomaly: 0.311 },
    { year: 1938, anomaly: 0.316 },
    { year: 1939, anomaly: 0.293 },
    { year: 1940, anomaly: 0.376 },
    { year: 1941, anomaly: 0.331 },
    { year: 1942, anomaly: 0.341 },
    { year: 1943, anomaly: 0.395 },
    { year: 1944, anomaly: 0.500 },
    { year: 1945, anomaly: 0.372 },
    { year: 1946, anomaly: 0.226 },
    { year: 1947, anomaly: 0.296 },
    { year: 1948, anomaly: 0.201 },
    { year: 1949, anomaly: 0.193 },
    { year: 1950, anomaly: 0.128 },
    { year: 1951, anomaly: 0.308 },
    { year: 1952, anomaly: 0.380 },
    { year: 1953, anomaly: 0.454 },
    { year: 1954, anomaly: 0.257 },
    { year: 1955, anomaly: 0.205 },
    { year: 1956, anomaly: 0.123 },
    { year: 1957, anomaly: 0.352 },
    { year: 1958, anomaly: 0.357 },
    { year: 1959, anomaly: 0.339 },
    { year: 1960, anomaly: 0.283 },
    { year: 1961, anomaly: 0.356 },
    { year: 1962, anomaly: 0.301 },
    { year: 1963, anomaly: 0.342 },
    { year: 1964, anomaly: 0.080 },
    { year: 1965, anomaly: 0.199 },
    { year: 1966, anomaly: 0.261 },
    { year: 1967, anomaly: 0.292 },
    { year: 1968, anomaly: 0.215 },
    { year: 1969, anomaly: 0.364 },
    { year: 1970, anomaly: 0.317 },
    { year: 1971, anomaly: 0.197 },
    { year: 1972, anomaly: 0.307 },
    { year: 1973, anomaly: 0.444 },
    { year: 1974, anomaly: 0.238 },
    { year: 1975, anomaly: 0.303 },
    { year: 1976, anomaly: 0.204 },
    { year: 1977, anomaly: 0.534 },
    { year: 1978, anomaly: 0.408 },
    { year: 1979, anomaly: 0.484 },
    { year: 1980, anomaly: 0.606 },
    { year: 1981, anomaly: 0.657 },
    { year: 1982, anomaly: 0.440 },
    { year: 1983, anomaly: 0.621 },
    { year: 1984, anomaly: 0.454 },
    { year: 1985, anomaly: 0.450 },
    { year: 1986, anomaly: 0.506 },
    { year: 1987, anomaly: 0.644 },
    { year: 1988, anomaly: 0.689 },
    { year: 1989, anomaly: 0.575 },
    { year: 1990, anomaly: 0.763 },
    { year: 1991, anomaly: 0.751 },
    { year: 1992, anomaly: 0.543 },
    { year: 1993, anomaly: 0.599 },
    { year: 1994, anomaly: 0.648 },
    { year: 1995, anomaly: 0.806 },
    { year: 1996, anomaly: 0.695 },
    { year: 1997, anomaly: 0.835 },
    { year: 1998, anomaly: 0.984 },
    { year: 1999, anomaly: 0.743 },
    { year: 2000, anomaly: 0.744 },
    { year: 2001, anomaly: 0.877 },
    { year: 2002, anomaly: 0.970 },
    { year: 2003, anomaly: 0.953 },
    { year: 2004, anomaly: 0.867 },
    { year: 2005, anomaly: 1.031 },
    { year: 2006, anomaly: 0.980 },
    { year: 2007, anomaly: 0.995 },
    { year: 2008, anomaly: 0.866 },
    { year: 2009, anomaly: 1.000 },
    { year: 2010, anomaly: 1.071 },
    { year: 2011, anomaly: 0.963 },
    { year: 2012, anomaly: 0.981 },
    { year: 2013, anomaly: 0.999 },
    { year: 2014, anomaly: 1.071, isCritical: true },
    { year: 2015, anomaly: 1.216, isCritical: true },
    { year: 2016, anomaly: 1.354, isCritical: true },
    { year: 2017, anomaly: 1.257, isCritical: true },
    { year: 2018, anomaly: 1.182, isCritical: true },
    { year: 2019, anomaly: 1.319, isCritical: true },
    { year: 2020, anomaly: 1.344, isCritical: true },
    { year: 2021, anomaly: 1.190, isCritical: true },
    { year: 2022, anomaly: 1.232, isCritical: true },
    { year: 2023, anomaly: 1.522, isCritical: true, record: true }
].map(d => ({
    ...d,
    value: d.year
}));


// Monthly data for crisis view
const monthlyData = [{'month': 'Jan', 'y2024': 1.578431, 'y2023': 1.12682, 'y2022': 1.15754, 'y2021': 1.123499, 'y2020': 1.461428, 'y2019': 1.164611, 'y2018': 1.120973, 'y2017': 1.283763, 'y2016': 1.431349, 'y2015': 1.072817, 'y2014': 1.007278, 'y2013': 1.027075, 'y2012': 0.714775, 'y2011': 0.789879, 'y2010': 1.073998, 'y2009': 0.940009, 'y2008': 0.552217, 'y2007': 1.243486, 'y2006': 0.836459, 'y2005': 1.027792, 'y2004': 0.83847, 'y2003': 0.986777, 'y2002': 0.975505, 'y2001': 0.650494, 'y2000': 0.490693, 'y1999': 0.653292, 'y1998': 0.832293, 'y1997': 0.510954, 'y1996': 0.520744, 'y1995': 0.751152, 'y1994': 0.484651, 'y1993': 0.572616, 'y1992': 0.669987, 'y1991': 0.714448, 'y1990': 0.650168, 'y1989': 0.284146, 'y1988': 0.749207, 'y1987': 0.547176, 'y1986': 0.447657, 'y1985': 0.457774, 'y1984': 0.478177, 'y1983': 0.728923, 'y1982': 0.303226, 'y1981': 0.706382, 'y1980': 0.580918, 'y1979': 0.458383, 'y1978': 0.324731, 'y1977': 0.342608, 'y1976': 0.148579, 'y1975': 0.238258, 'y1974': 0.13874, 'y1973': 0.524745, 'y1972': 0.009587, 'y1971': 0.216811, 'y1970': 0.380772, 'y1969': 0.177838, 'y1968': 0.038505, 'y1967': 0.14535, 'y1966': 0.140642, 'y1965': 0.141382, 'y1964': 0.242803, 'y1963': 0.229356, 'y1962': 0.288518, 'y1961': 0.361761, 'y1960': 0.311188, 'y1959': 0.371423, 'y1958': 0.584763, 'y1957': 0.092761, 'y1956': 0.123846, 'y1955': 0.299538, 'y1954': 0.004997, 'y1953': 0.228065, 'y1952': 0.370455, 'y1951': -0.037908, 'y1950': -0.030259}, {'month': 'Feb', 'y2024': 1.690215, 'y2023': 1.172542, 'y2022': 1.109647, 'y2021': 0.940157, 'y2020': 1.479083, 'y2019': 1.188331, 'y2018': 1.142553, 'y2017': 1.379462, 'y2016': 1.567727, 'y2015': 1.07879, 'y2014': 0.78426, 'y2013': 0.895684, 'y2012': 0.701038, 'y2011': 0.704048, 'y2010': 1.102215, 'y2009': 0.84528, 'y2008': 0.559233, 'y2007': 0.967981, 'y2006': 0.969388, 'y2005': 0.886, 'y2004': 0.907044, 'y2003': 0.792502, 'y2002': 0.871889, 'y2001': 0.597254, 'y2000': 0.74352, 'y1999': 0.832015, 'y1998': 1.034178, 'y1997': 0.565584, 'y1996': 0.657909, 'y1995': 0.945329, 'y1994': 0.243692, 'y1993': 0.571462, 'y1992': 0.629232, 'y1991': 0.75731, 'y1990': 0.604991, 'y1989': 0.543147, 'y1988': 0.546747, 'y1987': 0.590681, 'y1986': 0.501579, 'y1985': 0.185162, 'y1984': 0.322248, 'y1983': 0.686778, 'y1982': 0.391845, 'y1981': 0.630306, 'y1980': 0.63148, 'y1979': 0.192194, 'y1978': 0.296499, 'y1977': 0.293949, 'y1976': -0.01723, 'y1975': 0.220288, 'y1974': -0.072544, 'y1973': 0.550197, 'y1972': -0.028436, 'y1971': 0.032587, 'y1970': 0.405507, 'y1969': 0.1116, 'y1968': 0.096389, 'y1967': -0.025822, 'y1966': 0.20982, 'y1965': 0.037975, 'y1964': 0.202161, 'y1963': 0.34554, 'y1962': 0.353814, 'y1961': 0.39426, 'y1960': 0.394687, 'y1959': 0.31703, 'y1958': 0.411103, 'y1957': 0.083553, 'y1956': -0.001628, 'y1955': -0.036394, 'y1954': 0.084569, 'y1953': 0.27236, 'y1952': 0.288782, 'y1951': -0.165892, 'y1950': -0.05664}, {'month': 'Mar', 'y2024': 1.60802, 'y2023': 1.391506, 'y2022': 1.273964, 'y2021': 1.069514, 'y2020': 1.367639, 'y2019': 1.388174, 'y2018': 1.153204, 'y2017': 1.379672, 'y2016': 1.505874, 'y2015': 1.108721, 'y2014': 0.970714, 'y2013': 0.903997, 'y2012': 0.743862, 'y2011': 0.821493, 'y2010': 1.149033, 'y2009': 0.758865, 'y2008': 0.898851, 'y2007': 0.880775, 'y2006': 0.868637, 'y2005': 0.968547, 'y2004': 0.868877, 'y2003': 0.714054, 'y2002': 1.071059, 'y2001': 0.720904, 'y2000': 0.661497, 'y1999': 0.489249, 'y1998': 0.844655, 'y1997': 0.709793, 'y1996': 0.569628, 'y1995': 0.64425, 'y1994': 0.461589, 'y1993': 0.516333, 'y1992': 0.632891, 'y1991': 0.627148, 'y1990': 0.952817, 'y1989': 0.522694, 'y1988': 0.688013, 'y1987': 0.398663, 'y1986': 0.467201, 'y1985': 0.349293, 'y1984': 0.487251, 'y1983': 0.691769, 'y1982': 0.242742, 'y1981': 0.716326, 'y1980': 0.603193, 'y1979': 0.393527, 'y1978': 0.307078, 'y1977': 0.302936, 'y1976': -0.133189, 'y1975': 0.269375, 'y1974': 0.08583, 'y1973': 0.435482, 'y1972': 0.163299, 'y1971': 0.068642, 'y1970': 0.285024, 'y1969': 0.256422, 'y1968': 0.347557, 'y1967': 0.241239, 'y1966': 0.252563, 'y1965': 0.097739, 'y1964': 0.036224, 'y1963': 0.032078, 'y1962': 0.321561, 'y1961': 0.316583, 'y1960': -0.03141, 'y1959': 0.447295, 'y1958': 0.345492, 'y1957': 0.075999, 'y1956': 0.03697, 'y1955': -0.14483, 'y1954': 0.132276, 'y1953': 0.227578, 'y1952': 0.137138, 'y1951': 0.034767, 'y1950': 0.106158}, {'month': 'Apr', 'y2024': 1.550188, 'y2023': 1.200533, 'y2022': 1.163272, 'y2021': 1.070536, 'y2020': 1.40027, 'y2019': 1.317201, 'y2018': 1.185105, 'y2017': 1.208206, 'y2016': 1.409544, 'y2015': 0.936487, 'y2014': 0.989494, 'y2013': 0.843593, 'y2012': 0.934305, 'y2011': 0.893609, 'y2010': 1.132405, 'y2009': 0.819912, 'y2008': 0.753312, 'y2007': 1.053702, 'y2006': 0.810073, 'y2005': 0.950432, 'y2004': 0.8656, 'y2003': 0.759903, 'y2002': 0.81637, 'y2001': 0.726581, 'y2000': 0.79727, 'y1999': 0.576479, 'y1998': 1.000818, 'y1997': 0.552028, 'y1996': 0.535507, 'y1995': 0.760649, 'y1994': 0.599456, 'y1993': 0.554022, 'y1992': 0.460433, 'y1991': 0.757237, 'y1990': 0.82753, 'y1989': 0.565059, 'y1988': 0.691049, 'y1987': 0.545793, 'y1986': 0.580088, 'y1985': 0.407336, 'y1984': 0.410947, 'y1983': 0.603281, 'y1982': 0.342265, 'y1981': 0.66683, 'y1980': 0.695929, 'y1979': 0.371482, 'y1978': 0.328358, 'y1977': 0.371019, 'y1976': 0.058203, 'y1975': 0.238807, 'y1974': 0.120738, 'y1973': 0.46384, 'y1972': 0.265873, 'y1971': 0.170779, 'y1970': 0.399127, 'y1969': 0.418871, 'y1968': 0.192817, 'y1967': 0.224414, 'y1966': 0.183596, 'y1965': 0.076963, 'y1964': 0.008608, 'y1963': 0.145757, 'y1962': 0.289387, 'y1961': 0.362588, 'y1960': 0.135534, 'y1959': 0.412452, 'y1958': 0.340813, 'y1957': 0.219904, 'y1956': 0.00036, 'y1955': 0.035462, 'y1954': 0.107123, 'y1953': 0.377798, 'y1952': 0.174041, 'y1951': 0.161171, 'y1950': 0.043352}, {'month': 'May', 'y2024': 1.531748, 'y2023': 1.275212, 'y2022': 1.135714, 'y2021': 1.137261, 'y2020': 1.345828, 'y2019': 1.236672, 'y2018': 1.131714, 'y2017': 1.252424, 'y2016': 1.2952, 'y2015': 1.056476, 'y2014': 1.063227, 'y2013': 0.901334, 'y2012': 1.053395, 'y2011': 0.838135, 'y2010': 1.078257, 'y2009': 0.87585, 'y2008': 0.77471, 'y2007': 0.963758, 'y2006': 0.808176, 'y2005': 0.949472, 'y2004': 0.669599, 'y2003': 0.866206, 'y2002': 0.959866, 'y2001': 0.834116, 'y2000': 0.659276, 'y1999': 0.582591, 'y1998': 1.058124, 'y1997': 0.62751, 'y1996': 0.512716, 'y1995': 0.644759, 'y1994': 0.531463, 'y1993': 0.584662, 'y1992': 0.541286, 'y1991': 0.703201, 'y1990': 0.863336, 'y1989': 0.472628, 'y1988': 0.777491, 'y1987': 0.607183, 'y1986': 0.610605, 'y1985': 0.443011, 'y1984': 0.66506, 'y1983': 0.746639, 'y1982': 0.507925, 'y1981': 0.649982, 'y1980': 0.788648, 'y1979': 0.433177, 'y1978': 0.388175, 'y1977': 0.465021, 'y1976': 0.00365, 'y1975': 0.249606, 'y1974': 0.145609, 'y1973': 0.511453, 'y1972': 0.308289, 'y1971': 0.188166, 'y1970': 0.333579, 'y1969': 0.513714, 'y1968': 0.235075, 'y1967': 0.460232, 'y1966': 0.258716, 'y1965': 0.249331, 'y1964': 0.17231, 'y1963': 0.259512, 'y1962': 0.2517, 'y1961': 0.451619, 'y1960': 0.261437, 'y1959': 0.34979, 'y1958': 0.453326, 'y1957': 0.337521, 'y1956': 0.043366, 'y1955': 0.160446, 'y1954': 0.235869, 'y1953': 0.490254, 'y1952': 0.315733, 'y1951': 0.468137, 'y1950': 0.178317}, {'month': 'Jun', 'y2024': 1.554165, 'y2023': 1.411106, 'y2022': 1.187839, 'y2021': 1.092419, 'y2020': 1.240072, 'y2019': 1.248535, 'y2018': 1.104952, 'y2017': 1.081816, 'y2016': 1.141138, 'y2015': 1.066168, 'y2014': 0.952047, 'y2013': 0.987368, 'y2012': 0.999357, 'y2011': 0.900366, 'y2010': 0.966499, 'y2009': 0.884326, 'y2008': 0.681524, 'y2007': 0.85612, 'y2006': 0.961101, 'y2005': 0.956379, 'y2004': 0.786497, 'y2003': 0.741077, 'y2002': 0.903076, 'y2001': 0.768917, 'y2000': 0.635953, 'y1999': 0.647682, 'y1998': 1.063095, 'y1997': 0.799846, 'y1996': 0.564102, 'y1995': 0.793803, 'y1994': 0.625896, 'y1993': 0.577279, 'y1992': 0.557223, 'y1991': 0.907781, 'y1990': 0.695507, 'y1989': 0.473659, 'y1988': 0.723095, 'y1987': 0.688664, 'y1986': 0.431901, 'y1985': 0.413499, 'y1984': 0.374027, 'y1983': 0.61407, 'y1982': 0.459794, 'y1981': 0.630557, 'y1980': 0.626122, 'y1979': 0.448114, 'y1978': 0.254272, 'y1977': 0.491776, 'y1976': 0.136669, 'y1975': 0.185164, 'y1974': 0.160559, 'y1973': 0.424577, 'y1972': 0.467628, 'y1971': 0.157638, 'y1970': 0.377336, 'y1969': 0.402649, 'y1968': 0.194845, 'y1967': 0.286269, 'y1966': 0.368886, 'y1965': 0.206719, 'y1964': 0.236968, 'y1963': 0.360897, 'y1962': 0.225555, 'y1961': 0.417147, 'y1960': 0.311455, 'y1959': 0.36364, 'y1958': 0.339467, 'y1957': 0.408533, 'y1956': 0.080425, 'y1955': 0.160335, 'y1954': 0.150429, 'y1953': 0.35559, 'y1952': 0.336016, 'y1951': 0.379871, 'y1950': 0.239792}, {'month': 'Jul', 'y2024': 1.558072, 'y2023': 1.603431, 'y2022': 1.256579, 'y2021': 1.210008, 'y2020': 1.204484, 'y2019': 1.276095, 'y2018': 1.157538, 'y2017': 1.14482, 'y2016': 1.239737, 'y2015': 1.032891, 'y2014': 0.94496, 'y2013': 0.854195, 'y2012': 0.919503, 'y2011': 1.0223, 'y2010': 0.931193, 'y2009': 1.016921, 'y2008': 0.85579, 'y2007': 0.885585, 'y2006': 0.882565, 'y2005': 0.964587, 'y2004': 0.60342, 'y2003': 0.832028, 'y2002': 0.913216, 'y2001': 0.858775, 'y2000': 0.641505, 'y1999': 0.67731, 'y1998': 1.001027, 'y1997': 0.707209, 'y1996': 0.672849, 'y1995': 0.775363, 'y1994': 0.604643, 'y1993': 0.529345, 'y1992': 0.418104, 'y1991': 0.832063, 'y1990': 0.801835, 'y1989': 0.642198, 'y1988': 0.682629, 'y1987': 0.790715, 'y1986': 0.431343, 'y1985': 0.344195, 'y1984': 0.347985, 'y1983': 0.56331, 'y1982': 0.5418, 'y1981': 0.638246, 'y1980': 0.670459, 'y1979': 0.382265, 'y1978': 0.391523, 'y1977': 0.439737, 'y1976': 0.222953, 'y1975': 0.150641, 'y1974': 0.179589, 'y1973': 0.428088, 'y1972': 0.462849, 'y1971': 0.176125, 'y1970': 0.3633, 'y1969': 0.353249, 'y1968': 0.2859, 'y1967': 0.351784, 'y1966': 0.470949, 'y1965': 0.246504, 'y1964': 0.376171, 'y1963': 0.451914, 'y1962': 0.338027, 'y1961': 0.387337, 'y1960': 0.302384, 'y1959': 0.350533, 'y1958': 0.394125, 'y1957': 0.302877, 'y1956': 0.09946, 'y1955': 0.116799, 'y1954': 0.148046, 'y1953': 0.378084, 'y1952': 0.338514, 'y1951': 0.212191, 'y1950': 0.166888}, {'month': 'Aug', 'y2024': 1.590575, 'y2023': 1.589063, 'y2022': 1.175214, 'y2021': 1.190621, 'y2020': 1.146256, 'y2019': 1.235553, 'y2018': 1.087989, 'y2017': 1.175475, 'y2016': 1.28077, 'y2015': 1.121804, 'y2014': 1.015546, 'y2013': 0.934333, 'y2012': 0.95609, 'y2011': 0.990477, 'y2010': 0.925851, 'y2009': 0.924933, 'y2008': 0.800715, 'y2007': 0.860997, 'y2006': 0.950707, 'y2005': 0.909337, 'y2004': 0.718157, 'y2003': 0.925652, 'y2002': 0.83314, 'y2001': 0.828792, 'y2000': 0.704699, 'y1999': 0.642177, 'y1998': 1.021195, 'y1997': 0.745739, 'y1996': 0.76821, 'y1995': 0.772853, 'y1994': 0.495435, 'y1993': 0.495324, 'y1992': 0.391621, 'y1991': 0.740169, 'y1990': 0.713779, 'y1989': 0.558287, 'y1988': 0.713368, 'y1987': 0.609067, 'y1986': 0.442656, 'y1985': 0.485707, 'y1984': 0.441374, 'y1983': 0.630169, 'y1982': 0.426061, 'y1981': 0.643679, 'y1980': 0.595499, 'y1979': 0.470461, 'y1978': 0.157811, 'y1977': 0.41316, 'y1976': 0.126522, 'y1975': 0.041782, 'y1974': 0.258799, 'y1973': 0.255933, 'y1972': 0.423296, 'y1971': 0.175569, 'y1970': 0.196072, 'y1969': 0.221618, 'y1968': 0.227085, 'y1967': 0.308846, 'y1966': 0.300366, 'y1965': 0.207551, 'y1964': 0.185338, 'y1963': 0.527169, 'y1962': 0.278844, 'y1961': 0.330971, 'y1960': 0.34802, 'y1959': 0.286276, 'y1958': 0.302434, 'y1957': 0.352416, 'y1956': -0.003705, 'y1955': 0.280124, 'y1954': 0.077722, 'y1953': 0.350243, 'y1952': 0.193068, 'y1951': 0.391799, 'y1950': 0.063395}, {'month': 'Sep', 'y2024': 1.607906, 'y2023': 1.810606, 'y2022': 1.229395, 'y2021': 1.281365, 'y2020': 1.31349, 'y2019': 1.258724, 'y2018': 1.079401, 'y2017': 1.159539, 'y2016': 1.237732, 'y2015': 1.146862, 'y2014': 1.064431, 'y2013': 1.04968, 'y2012': 0.992898, 'y2011': 0.927352, 'y2010': 0.97903, 'y2009': 0.98371, 'y2008': 0.84988, 'y2007': 0.790178, 'y2006': 0.92809, 'y2005': 1.009663, 'y2004': 0.839929, 'y2003': 0.953814, 'y2002': 0.885221, 'y2001': 0.801837, 'y2000': 0.641267, 'y1999': 0.679306, 'y1998': 0.827207, 'y1997': 0.815322, 'y1996': 0.552444, 'y1995': 0.679367, 'y1994': 0.641278, 'y1993': 0.363351, 'y1992': 0.270868, 'y1991': 0.678131, 'y1990': 0.649425, 'y1989': 0.597063, 'y1988': 0.692694, 'y1987': 0.655903, 'y1986': 0.353049, 'y1985': 0.35913, 'y1984': 0.393906, 'y1983': 0.683033, 'y1982': 0.414424, 'y1981': 0.543963, 'y1980': 0.512224, 'y1979': 0.503641, 'y1978': 0.195263, 'y1977': 0.234568, 'y1976': 0.182779, 'y1975': 0.040215, 'y1974': 0.085906, 'y1973': 0.287178, 'y1972': 0.330888, 'y1971': 0.200043, 'y1970': 0.266739, 'y1969': 0.301777, 'y1968': 0.137382, 'y1967': 0.298036, 'y1966': 0.278923, 'y1965': 0.157541, 'y1964': -0.016466, 'y1963': 0.432715, 'y1962': 0.233649, 'y1961': 0.363843, 'y1960': 0.256239, 'y1959': 0.175579, 'y1958': 0.224237, 'y1957': 0.346153, 'y1956': -0.041639, 'y1955': 0.19653, 'y1954': 0.004843, 'y1953': 0.247957, 'y1952': 0.267381, 'y1951': 0.387138, 'y1950': 0.215175}, {'month': 'Oct', 'y2024': 1.678608, 'y2023': 1.72952, 'y2022': 1.288646, 'y2021': 1.301016, 'y2020': 1.255664, 'y2019': 1.332855, 'y2018': 1.234327, 'y2017': 1.239071, 'y2016': 1.221304, 'y2015': 1.32097, 'y2014': 1.043295, 'y2013': 0.93113, 'y2012': 1.098893, 'y2011': 0.90931, 'y2010': 0.996096, 'y2009': 0.959727, 'y2008': 0.916865, 'y2007': 0.865707, 'y2006': 1.017671, 'y2005': 1.051599, 'y2004': 0.886457, 'y2003': 0.983792, 'y2002': 0.798822, 'y2001': 0.773701, 'y2000': 0.484063, 'y1999': 0.578369, 'y1998': 0.702086, 'y1997': 0.826886, 'y1996': 0.439435, 'y1995': 0.684845, 'y1994': 0.587755, 'y1993': 0.449513, 'y1992': 0.278331, 'y1991': 0.531471, 'y1990': 0.721528, 'y1989': 0.504949, 'y1988': 0.528257, 'y1987': 0.533575, 'y1986': 0.285928, 'y1985': 0.233002, 'y1984': 0.357816, 'y1983': 0.404451, 'y1982': 0.359803, 'y1981': 0.460973, 'y1980': 0.424105, 'y1979': 0.515216, 'y1978': 0.184228, 'y1977': 0.163458, 'y1976': -0.180034, 'y1975': -0.048112, 'y1974': 0.047731, 'y1973': 0.236683, 'y1972': 0.330881, 'y1971': 0.087758, 'y1970': 0.239352, 'y1969': 0.269792, 'y1968': 0.317048, 'y1967': 0.360163, 'y1966': 0.099132, 'y1965': 0.199612, 'y1964': -0.121936, 'y1963': 0.375494, 'y1962': 0.272158, 'y1961': 0.30062, 'y1960': 0.310629, 'y1959': 0.241757, 'y1958': 0.256262, 'y1957': 0.358326, 'y1956': -0.106611, 'y1955': 0.141918, 'y1954': 0.108121, 'y1953': 0.28189, 'y1952': 0.187778, 'y1951': 0.397847, 'y1950': 0.233146}, {'month': 'Nov', 'y2024': 1.607984, 'y2023': 1.733744, 'y2022': 1.042155, 'y2021': 1.225961, 'y2020': 1.417061, 'y2019': 1.284842, 'y2018': 1.118191, 'y2017': 1.12791, 'y2016': 1.284787, 'y2015': 1.265826, 'y2014': 0.931153, 'y2013': 1.02969, 'y2012': 1.075946, 'y2011': 0.785374, 'y2010': 1.013778, 'y2009': 1.02087, 'y2008': 0.931453, 'y2007': 0.841246, 'y2006': 0.981027, 'y2005': 1.011404, 'y2004': 0.951114, 'y2003': 0.842551, 'y2002': 0.82527, 'y2001': 0.979592, 'y2000': 0.53345, 'y1999': 0.576898, 'y1998': 0.640893, 'y1997': 0.86166, 'y1996': 0.66046, 'y1995': 0.655734, 'y1994': 0.630524, 'y1993': 0.337449, 'y1992': 0.262132, 'y1991': 0.521694, 'y1990': 0.759476, 'y1989': 0.389931, 'y1988': 0.310997, 'y1987': 0.506722, 'y1986': 0.378589, 'y1985': 0.286029, 'y1984': 0.227254, 'y1983': 0.525846, 'y1982': 0.35913, 'y1981': 0.454862, 'y1980': 0.450538, 'y1979': 0.495563, 'y1978': 0.352879, 'y1977': 0.39667, 'y1976': 0.060164, 'y1975': 0.004456, 'y1974': 0.079822, 'y1973': 0.266942, 'y1972': 0.242892, 'y1971': 0.126582, 'y1970': 0.224328, 'y1969': 0.399347, 'y1968': 0.166654, 'y1967': 0.21168, 'y1966': 0.184067, 'y1965': 0.190266, 'y1964': 0.001822, 'y1963': 0.370093, 'y1962': 0.276626, 'y1961': 0.269332, 'y1960': 0.162328, 'y1959': 0.144412, 'y1958': 0.247499, 'y1957': 0.369633, 'y1956': 0.026245, 'y1955': -0.040248, 'y1954': 0.196749, 'y1953': 0.186234, 'y1952': -0.031476, 'y1951': 0.300005, 'y1950': -0.02109}, {'month': 'Dec', 'y2023': 1.724711, 'y2022': 1.150412, 'y2021': 1.201935, 'y2020': 1.114681, 'y2019': 1.419143, 'y2018': 1.210675, 'y2017': 1.251532, 'y2016': 1.215172, 'y2015': 1.41911, 'y2014': 1.068095, 'y2013': 1.006517, 'y2012': 0.847875, 'y2011': 0.841946, 'y2010': 0.77824, 'y2009': 0.948005, 'y2008': 0.835984, 'y2007': 0.790671, 'y2006': 1.075202, 'y2005': 0.981006, 'y2004': 0.784207, 'y2003': 1.057259, 'y2002': 0.757754, 'y2001': 0.910048, 'y2000': 0.537711, 'y1999': 0.656367, 'y1998': 0.792567, 'y1997': 0.832067, 'y1996': 0.634009, 'y1995': 0.539472, 'y1994': 0.607944, 'y1993': 0.527097, 'y1992': 0.416645, 'y1991': 0.542992, 'y1990': 0.730398, 'y1989': 0.640044, 'y1988': 0.510317, 'y1987': 0.753988, 'y1986': 0.43278, 'y1985': 0.334055, 'y1984': 0.276642, 'y1983': 0.455967, 'y1982': 0.646849, 'y1981': 0.645205, 'y1980': 0.407468, 'y1979': 0.74779, 'y1978': 0.365264, 'y1977': 0.338379, 'y1976': 0.213437, 'y1975': 0.056788, 'y1974': 0.117173, 'y1973': 0.27435, 'y1972': 0.441606, 'y1971': 0.19391, 'y1970': 0.182009, 'y1969': 0.528552, 'y1968': 0.141041, 'y1967': 0.265556, 'y1966': 0.223112, 'y1965': 0.221083, 'y1964': -0.034442, 'y1963': 0.30242, 'y1962': 0.25916, 'y1961': 0.159618, 'y1960': 0.445592, 'y1959': 0.289227, 'y1958': 0.271396, 'y1957': 0.420785, 'y1956': 0.132946, 'y1955': -0.066169, 'y1954': 0.067318, 'y1953': 0.284625, 'y1952': 0.177924, 'y1951': 0.415623, 'y1950': 0.217754}].map(d => ({ ...d, value: d.month }));


// Style pour le point record qui clignote
const recordDotStyles = `
    @keyframes pulse {
        0% { r: 4; opacity: 1; }
        50% { r: 6; opacity: 0.5; }
        100% { r: 4; opacity: 1; }
    }
    .record-dot {
        animation: pulse 1.5s ease-in-out infinite;
    }
`;

const TemperatureViz = () => {
    const [view, setView] = useState('historical');

    const getDataAndConfig = () => {
        switch(view) {
            case 'historical':
                return {
                    data: historicalData,
                    xDomain: [-9000, 2024],
                    tickInterval: 1000,
                    xLabel: 'Years',
                    yDomain: [-1, 2],
                    yTicks: [-1, -0.5, 0, 0.5, 1, 1.5, 2],
                    yLabel: 'Temperature Anomaly (°C from 1850-1900)'
                };
            case 'recent':
                return {
                    data: modernData,
                    xDomain: [1850, 2024],
                    tickInterval: 10,
                    xLabel: 'Year',
                    yDomain: [-0.5, 2],
                    yTicks: [-0.5, 0, 0.5, 1.0, 1.5, 2.0],
                    yLabel: 'Temperature Anomaly (°C from 1850-1900)'
                };
            case 'crisis':
                return {
                    data: monthlyData,
                    xLabel: 'Month',
                    yDomain: [0.5, 2],
                    yTicks: [0.5, 1, 1.5, 2.0],
                    yLabel: 'Temperature Anomaly (°C from 1850-1900)'
                };
            default:
                return null;
        }
    };

    const config = getDataAndConfig();

    const CustomTooltip = ({ active, payload, label }) => {
        if (!active || !payload || !payload.length) return null;

        if (view === 'crisis') {
            return (
                <div className="chart-tooltip">
                    <p className="chart-tooltip-label">{label}</p>
                    {payload.map((entry, index) => (
                        <p key={index} className="chart-tooltip-value">
                            {`${entry.name}: +${entry.value.toFixed(2)}°C`}
                        </p>
                    ))}
                </div>
            );
        }

        return (
            <div className="chart-tooltip">
                <p className="chart-tooltip-label">{numberToLabel(label, view)}</p>
                <p className="chart-tooltip-value">
                    {`${payload[0].value > 0 ? '+' : ''}${payload[0].value.toFixed(2)}°C`}
                </p>
                {payload[0].payload.record && (
                    <p className="font-bold">⚠️ New Record</p>
                )}
            </div>
        );
    };

    const renderMonthlyChart = () => (
        <ResponsiveContainer width="100%" height={500}>
            <ComposedChart
                data={config.data}
                margin={{ top: 20, right: 30, left: 20, bottom: 30 }}
            >
                <CartesianGrid strokeDasharray="3 3" stroke="var(--chart-grid)" />
                <XAxis 
                    dataKey="month"
                    stroke="var(--chart-axis)"
                />
                <YAxis
                    domain={config.yDomain}
                    ticks={config.yTicks}
                    stroke="var(--chart-axis)"
                    label={{ 
                        value: config.yLabel, 
                        angle: -90,
                        position: 'middle',
                        dx: -20,
                        style: { fill: 'var(--chart-axis)' }
                    }}
                />
                <Tooltip content={<CustomTooltip />} />
                
                <ReferenceLine 
                    y={1.5}
                    stroke="var(--chart-line-4)"
                    strokeDasharray="3 3"
                    label={{ 
                        value: "1.5°C threshold",
                        fill: "var(--chart-line-3)",
                        position: 'right'
                    }}
                />

{['y2024', 'y2023', 'y2022', 'y2021', 'y2020', 'y2019', 'y2018', 'y2017', 'y2016', 'y2015', 'y2014', 'y2013', 'y2012', 'y2011', 'y2010', 'y2009', 'y2008', 'y2007', 'y2006', 'y2005', 'y2004', 'y2003', 'y2002', 'y2001', 'y2000', 'y1999', 'y1998', 'y1997', 'y1996', 'y1995', 'y1994', 'y1993', 'y1992', 'y1991', 'y1990', 'y1989', 'y1988', 'y1987', 'y1986', 'y1985', 'y1984', 'y1983', 'y1982', 'y1981', 'y1980', 'y1979', 'y1978', 'y1977', 'y1976', 'y1975', 'y1974', 'y1973', 'y1972', 'y1971', 'y1970', 'y1969', 'y1968', 'y1967', 'y1966', 'y1965', 'y1964', 'y1963', 'y1962', 'y1961', 'y1960', 'y1959', 'y1958', 'y1957', 'y1956', 'y1955', 'y1954', 'y1953', 'y1952', 'y1951', 'y1950'].map((year, index) => (
    <Line
        key={year}
        type="monotone"
        dataKey={year}
        name={year.substring(1)}
        stroke={`var(--chart-temp-${index + 1})`}
        strokeWidth={1}
        dot={false}
        opacity={0.5}
    />
))}
{/* Lignes 2023 et 2024 avec style spécial */}
<Line
    type="monotone"
    dataKey="y2023"
    name="2023"
    stroke="var(--chart-line-5)"
    strokeWidth={2.5}
    dot={true}
/>
<Line
    type="monotone"
    dataKey="y2024"
    name="2024"
    stroke="var(--chart-line-2)"
    strokeWidth={2.5}
    dot={true}
/>

        <Legend
            verticalAlign="top"
            height={36}
            wrapperStyle={{
                paddingBottom: '20px'
            }}
            payload={[
                { value: 'y2023', type: 'line', color: 'var(--chart-line-5)', dataKey: 'y2023' },
                { value: 'y2024', type: 'line', color: 'var(--chart-line-2)', dataKey: 'y2024' }
            ]}
            formatter={(value) => {
                if (value === 'y2023' || value === 'y2024') {
                    return `${value.substring(1)} (Record year)`;
                }
                return '';
            }}
        />
               
            </ComposedChart>
        </ResponsiveContainer>
    );

    const renderTimeSeries = () => (
        <ResponsiveContainer width="100%" height={500}>
            <ComposedChart
                data={config.data}
                margin={{ top: 20, right: 30, left: 20, bottom: 30 }}
            >
                <style>{recordDotStyles}</style>
                <CartesianGrid strokeDasharray="3 3" stroke="var(--chart-grid)" opacity="0.5" />
                <XAxis
                    id="default"
                    dataKey="value"
                    type="number"
                    domain={config.xDomain}
                    ticks={generateTicks(config.xDomain[0], config.xDomain[1], config.tickInterval)}
                    tickFormatter={(value) => numberToLabel(value, view)}
                    stroke="var(--chart-axis)"
                    label={{
                        value: config.xLabel,
                        position: 'bottom',
                        style: { fill: 'var(--chart-axis)' }
                    }}
                />
                <YAxis
                    domain={config.yDomain}
                    ticks={config.yTicks}
                    stroke="var(--chart-axis)"
                    label={{ 
                        value: config.yLabel, 
                        angle: -90,
                        position: 'center',
                        dx: -20,
                        style: { fill: 'var(--chart-axis)', textAnchor: 'middle' }
                    }}
                />
                <Tooltip content={<CustomTooltip />} />
                
                <ReferenceLine 
                    y={1.5}
                    stroke="var(--chart-line-2)"
                    strokeDasharray="3 3"
                    label={{ 
                        value: "1.5°C threshold",
                        fill: "var(--chart-line-2)",
                        position: 'right'
                    }}
                />

                {/* Lignes de tendance pour la vue modern */}
{view === 'recent' && (
    <>
        <Line
            data={[
                { year: 1964, value: 1964, anomaly: 0.199 },
                { year: 2014, value: 2014, anomaly: 1.071 }
            ]}
            type="monotone"
            dataKey="anomaly"
            stroke="var(--chart-line-5)"
            strokeWidth={4}

            dot={false}
            isAnimationActive={false}
            name="1961-2014 trend"
        />
        <Line
            data={[
                { year: 2014, value: 2014, anomaly: 1.071 },
                { year: 2024, value: 2024, anomaly: 1.25 }
            ]}
            type="monotone"
            dataKey="anomaly"
            stroke="var(--chart-line-5)"
            strokeWidth={4}
            dot={false}
            isAnimationActive={false}
            name="2015-2024 trend"
        />
    </>
)}
                <Area
                    type="monotone"
                    dataKey="anomaly"
                    stroke="var(--chart-line-1)"
                    strokeWidth={2}
                    fill="url(#colorGradient)"
                />

                <Line
                    type="monotone"
                    dataKey={d => d.isCritical ? d.anomaly : null}
                    stroke="var(--chart-line-2)"
                    strokeWidth={3}
                    dot={(props) => {
                        const { record } = props.payload || {};
                        if (record) {
                            return (
                                <circle
                                    {...props}
                                    className="record-dot"
                                    fill="var(--chart-line-2)"
                                    stroke="var(--chart-line-2)"
                                    strokeWidth={2}
                                />
                            );
                        }
                        return null;
                    }}
                />
                
                <defs>
                    <linearGradient id="colorGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="var(--chart-line-2)" stopOpacity={0.4}/>
                        <stop offset="95%" stopColor="var(--chart-line-2)" stopOpacity={0.1}/>
                    </linearGradient>
                </defs>
            </ComposedChart>
        </ResponsiveContainer>
    );

    return (
        <div className="dashboard-container">
            <div className="dashboard-header">
                <div className="dashboard-title">
                    <h3>Global Temperature Change</h3>
                    <p>Temperature anomaly relative to 1850-1900 baseline</p>
                </div>
            </div>

            <div className="dashboard-buttons">
                {['historical', 'recent', 'crisis'].map((v) => (
                    <button
                        key={v}
                        onClick={() => setView(v)}
                        className={`dashboard-button ${view === v ? 'selected' : ''}`}
                    >
                        {v.charAt(0).toUpperCase() + v.slice(1)}
                    </button>
                ))}
            </div>

            <div className="dashboard-chart-container">
                {view === 'crisis' ? renderMonthlyChart() : renderTimeSeries()}
            </div>

            <div className="dashboard-source">
                <p>
                    Source: Data from Berkeley Earth, ERAS.
                    {view === 'crisis' && " Monthly data shown for recent years."}
                </p>
                {view === 'crisis' && (
                    <p className="dashboard-warning">
                        ⚠️ Warning: Current temperatures are unprecedented in human history
                    </p>
                )}
            </div>
        </div>
    );
};

export default TemperatureViz;
